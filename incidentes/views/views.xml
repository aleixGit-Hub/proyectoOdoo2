<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_open_parte" model="ir.actions.act_window">
        <field name="name">Gesti칩n de Partes</field>
        <field name="res_model">parte</field>
        <field name="view_mode">tree,kanban,calendar,graph,pivot,form</field>
        <field name="search_view_id" ref="view_parte_search"/>
    </record>

    <record id="action_open_grupo" model="ir.actions.act_window">
        <field name="name">Grupos</field>
        <field name="res_model">grupo</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('incidentes.group_parte_manager'))]"/>
    </record>

    <record id="action_open_alumno" model="ir.actions.act_window">
        <field name="name">Alumnos</field>
        <field name="res_model">alumno</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('incidentes.group_parte_manager'))]"/>
    </record>

    <record id="action_open_profesor" model="ir.actions.act_window">
        <field name="name">Profesores</field>
        <field name="res_model">profesor</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('incidentes.group_parte_manager'))]"/>
    </record>

    <record id="action_open_asignatura" model="ir.actions.act_window">
        <field name="name">Asignaturas</field>
        <field name="res_model">asignatura</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('incidentes.group_parte_manager'))]"/>
    </record>

    <record id="view_parte_tree" model="ir.ui.view">
        <field name="name">parte.tree</field>
        <field name="model">parte</field>
        <field name="arch" type="xml">
            <tree string="Listado de Partes"
                  decoration-success="estado == 'llamado'"
                  decoration-warning="estado == 'pendiente_llamar'"
                  decoration-muted="estado == 'cerrado'">

                <field name="name"            string="Referencia"/>
                <field name="alumno_id"       string="Alumno"/>
                <field name="grupo_id"        string="Grupo"/>
                <field name="fecha_hora"      string="Fecha y hora"/>
                <field name="motivo"          string="Motivo"/>
                <field name="estado"          widget="badge" string="Estado"/>
                <field name="priority"        widget="priority"/>
                <field name="tiene_expulsion" widget="boolean_toggle"
                       groups="incidentes.group_parte_manager" string="Expulsi칩n"/>
                <field name="profesor_id"     string="Profesor"/>
            </tree>
        </field>
    </record>

    <record id="view_parte_form" model="ir.ui.view">
        <field name="name">parte.form</field>
        <field name="model">parte</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="estado" widget="statusbar"
                           statusbar_visible="pendiente_llamar,llamado,cerrado"
                           options="{'clickable': '1'}"
                    />
                </header>
                <sheet>
                    <widget name="web_ribbon" title="EXPULSI칍N" bg_color="bg-danger"
                            attrs="{'invisible': [('tiene_expulsion', '=', False)]}"
                            groups="incidentes.group_parte_manager"/>

                    <div class="oe_button_box" name="button_box">
                        <button name="action_ver_partes_alumno" type="object"
                                class="oe_stat_button" icon="fa-file-text-o">
                            <field name="total_partes_alumno" widget="statinfo" string="Partes alumno"/>
                        </button>
                        <button name="action_ver_expulsiones_alumno" type="object"
                                class="oe_stat_button" icon="fa-ban">
                            <field name="total_expulsiones_alumno" widget="statinfo" string="Expulsiones"/>
                        </button>
                        <button name="action_ver_pendientes_grupo" type="object"
                                class="oe_stat_button" icon="fa-phone">
                            <field name="total_pendientes_grupo" widget="statinfo" string="Pendientes grupo"/>
                        </button>
                    </div>

                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" readonly="1"/></h1>
                        <field name="priority" widget="priority"/>
                    </div>

                    <group>
                        <group string="Datos del Incidente">
                            <field name="profesor_id"/>
                            <field name="asignatura_id"/>
                            <field name="fecha_hora"/>
                            <field name="ubicacion"/>
                            <field name="motivo"/>
                            <field name="testigos"/>
                        </group>
                        <group string="Alumno e Incidencia">
                            <field name="alumno_id"/>
                            <field name="grupo_id"/>
                            <field name="tiene_expulsion" widget="boolean_toggle"
                                   groups="incidentes.group_parte_manager"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Descripci칩n de los Hechos">
                            <field name="descripcion"
                                   placeholder="Explica aqu칤 qu칠 ha pasado exactamente..."/>
                        </page>
                        <page string="游 Registro de Llamadas a Familia">
                            <div class="alert alert-info mb-2" role="alert">
                                <strong>Instrucciones:</strong>
                                A침ade una l칤nea por cada intento de contacto.
                                Si el resultado es <strong>Contactado</strong>, el estado
                                cambiar치 autom치ticamente.
                            </div>
                            <field name="llamada_ids">
                                <tree editable="bottom">
                                    <field name="fecha"/>
                                    <field name="resultado"/>
                                    <field name="notas"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Observaciones" groups="incidentes.group_parte_manager">
                            <div class="alert alert-warning mb-2" role="alert">
                                <strong>Uso exclusivo de direcci칩n.</strong>
                            </div>
                            <field name="observaciones"
                                   placeholder="Medidas cautelares, resoluciones o im치genes..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_grupo_tree" model="ir.ui.view">
        <field name="name">grupo.tree</field>
        <field name="model">grupo</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="etapa"/>
                <field name="tutor_id"/>
            </tree>
        </field>
    </record>

    <record id="view_alumno_tree" model="ir.ui.view">
        <field name="name">alumno.tree</field>
        <field name="model">alumno</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="grupo_id"/>
            </tree>
        </field>
    </record>

    <record id="view_profesor_tree" model="ir.ui.view">
        <field name="name">profesor.tree</field>
        <field name="model">profesor</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="dni"/>
                <field name="user_id"/>
            </tree>
        </field>
    </record>

    <record id="view_asignatura_tree" model="ir.ui.view">
        <field name="name">asignatura.tree</field>
        <field name="model">asignatura</field>
        <field name="arch" type="xml">
            <tree><field name="name"/></tree>
        </field>
    </record>

    <record id="view_grupo_form" model="ir.ui.view">
        <field name="name">grupo.form</field>
        <field name="model">grupo</field>
        <field name="arch" type="xml">
            <form><sheet><group>
                <field name="name"/>
                <field name="etapa"/>
                <field name="tutor_id"/>
            </group></sheet></form>
        </field>
    </record>

    <record id="view_alumno_form" model="ir.ui.view">
        <field name="name">alumno.form</field>
        <field name="model">alumno</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="grupo_id"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_profesor_form" model="ir.ui.view">
        <field name="name">profesor.form</field>
        <field name="model">profesor</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group><field name="name"/></group>
                        <group>
                            <field name="dni"/>
                            <field name="user_id"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_asignatura_form" model="ir.ui.view">
        <field name="name">asignatura.form</field>
        <field name="model">asignatura</field>
        <field name="arch" type="xml">
            <form><sheet><group><field name="name"/></group></sheet></form>
        </field>
    </record>

    <menuitem id="menu_principal" name="Partes de Incidentes"/>
    <menuitem id="menu_partes" name="Gesti칩n de Partes" parent="menu_principal" action="action_open_parte" sequence="1"/>
    <menuitem id="menu_configuracion" name="Configuraci칩n" parent="menu_principal" sequence="20" groups="incidentes.group_parte_manager"/>
    <menuitem id="menu_alumnos" name="Alumnos" parent="menu_configuracion" action="action_open_alumno" groups="incidentes.group_parte_manager"/>
    <menuitem id="menu_grupos" name="Grupos" parent="menu_configuracion" action="action_open_grupo" groups="incidentes.group_parte_manager"/>
    <menuitem id="menu_profesor" name="Profesores" parent="menu_configuracion" action="action_open_profesor" groups="incidentes.group_parte_manager"/>
    <menuitem id="menu_asignatura" name="Asignaturas" parent="menu_configuracion" action="action_open_asignatura" groups="incidentes.group_parte_manager"/>

</odoo>